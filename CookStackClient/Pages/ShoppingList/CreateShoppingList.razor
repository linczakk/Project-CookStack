@using CookStackClient.Services
@using CookStackShared.ShoppingList.Dtos

@inject ShoppingListApiClient Api

@if(IsOpen)
{
	<div class="card">
		<div class="modal-backdrop fade show"></div>

		<div class="modal fade show d-block" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<EditForm Model="@shoppingListDto" OnValidSubmit="Save">
						<DataAnnotationsValidator />

						<div class="modal-body">
							<InputText class="form-control" @bind-Value="shoppingListDto.Title" @onchange="CheckTitle" />
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" @onclick="Cancel">Cancel</button>
							<button type="submit" class="btn btn-primary" disabled=@IsTheTitleEmpty>Save</button>
						</div>
					</EditForm>
				</div>
			</div>
		</div>
	</div>
}

@code{

	private CreateShoppingListDto shoppingListDto { get; set; } = new();
	private bool IsOpen;
	private bool IsTheTitleEmpty = true;

	private void CheckTitle() => IsTheTitleEmpty = shoppingListDto.Title.Count() >= 0 /*TODO: FIX THIS*/;

	public void Show()
	{
		shoppingListDto = new();
		IsOpen = true;
		StateHasChanged();
	}

	public void Cancel() => IsOpen = false;

	private async Task Save()
	{
		IsOpen = false;
		await Api.CreateShoppingListAsync(shoppingListDto);
	}
}